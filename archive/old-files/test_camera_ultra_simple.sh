#!/bin/bash

echo "🔧 TEST CAMERA ULTRA SIMPLE FIX"
echo "==============================="

echo "📱 Kiểm tra frontend..."
if curl -s -k https://10.10.68.200:5173 > /dev/null; then
    echo "✅ Frontend đang chạy trên https://10.10.68.200:5173"
else
    echo "❌ Frontend không chạy"
    exit 1
fi

echo "🔧 Kiểm tra backend..."
if curl -s -k https://10.10.68.200:8000/health > /dev/null; then
    echo "✅ Backend đang chạy trên https://10.10.68.200:8000"
else
    echo "❌ Backend không chạy"
    exit 1
fi

echo ""
echo "🎯 HƯỚNG DẪN TEST CAMERA ULTRA SIMPLE:"
echo "======================================"
echo ""
echo "1. 📱 Mở trình duyệt và truy cập:"
echo "   https://10.10.68.200:5173"
echo ""
echo "2. 🔐 Đăng nhập với tài khoản admin/manager/employee"
echo ""
echo "3. 📷 Test camera trên QR Scanner:"
echo "   https://10.10.68.200:5173/qr-scan"
echo ""
echo "4. 🧪 Test file HTML đơn giản:"
echo "   Mở file: test_camera_simple.html trong trình duyệt"
echo ""
echo "✅ CẢI TIẾN ĐÃ THỰC HIỆN:"
echo "========================"
echo ""
echo "1. 🔔 Nút thông báo nhỏ hơn:"
echo "   - Giảm kích thước từ p-4 → p-2"
echo "   - Giảm text từ text-lg → text-sm"
echo "   - Thêm max-w-xs để giới hạn chiều rộng"
echo "   - Nút ẩn chỉ hiển thị icon 🔔"
echo ""
echo "2. 🎥 UltraSimpleCamera component:"
echo "   - Không sử dụng GlobalCameraManager (tránh xung đột)"
echo "   - Constraints cực kỳ đơn giản: chỉ facingMode"
echo "   - Timeout ngắn: 5 giây"
echo "   - Tự quản lý stream riêng"
echo ""
echo "3. 🔧 Sửa lỗi duplicate method:"
echo "   - Xóa duplicate getStream method trong GlobalCameraManager"
echo "   - Tránh lỗi build"
echo ""
echo "4. 📱 Tối ưu cho mobile:"
echo "   - Nút nhỏ hơn, ít chiếm chỗ"
echo "   - Camera load nhanh hơn"
echo "   - Ít xung đột giữa các camera"
echo ""
echo "🔍 CÁC LỖI ĐÃ SỬA:"
echo "=================="
echo ""
echo "❌ Nút 'Bật thông báo' chiếm góc màn hình điện thoại"
echo "   ✅ FIXED: Giảm kích thước, chỉ hiển thị icon 🔔 khi ẩn"
echo ""
echo "❌ Camera báo 'đang khởi động' mãi"
echo "   ✅ FIXED: UltraSimpleCamera không dùng GlobalCameraManager"
echo ""
echo "❌ Xung đột giữa camera QR và camera chụp ảnh"
echo "   ✅ FIXED: Mỗi camera tự quản lý stream riêng"
echo ""
echo "❌ Duplicate method getStream"
echo "   ✅ FIXED: Xóa method duplicate trong GlobalCameraManager"
echo ""
echo "🚀 BẮT ĐẦU TEST..."
echo "=================="
echo ""
echo "Mở trình duyệt và test theo hướng dẫn trên!"
echo ""
echo "📞 Nếu vẫn gặp lỗi, hãy:"
echo "   1. Mở DevTools (F12) và xem Console log"
echo "   2. Test file test_camera_simple.html trước"
echo "   3. Kiểm tra quyền camera trong trình duyệt"
echo "   4. Thử trên thiết bị khác"
echo ""
echo "🎉 Camera bây giờ sẽ hoạt động ổn định và nhanh hơn!"
