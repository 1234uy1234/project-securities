#!/bin/bash

echo "=== TEST FLOWSTEP HOÃ€N CHá»ˆNH ==="
echo ""

echo "1. Tasks vá»›i Ä‘áº§y Ä‘á»§ thÃ´ng tin:"
sqlite3 backend/app.db "SELECT pt.id, pt.title, pts.completed, pts.completed_at, pts.scheduled_time FROM patrol_tasks pt LEFT JOIN patrol_task_stops pts ON pt.id = pts.task_id WHERE pt.id >= 54 ORDER BY pt.id DESC;"

echo ""
echo "2. Checkin Records vá»›i áº£nh:"
sqlite3 backend/app.db "SELECT id, task_id, location_id, check_in_time, photo_path FROM patrol_records WHERE task_id >= 54 ORDER BY id DESC;"

echo ""
echo "=== FLOWSTEP Sáº¼ HIá»‚N THá»Š ==="
echo ""

echo "ğŸ“‹ TASK 55 - 'Test Ä‘Ãºng giá»':"
echo "   âœ… Completed: true"
echo "   â° Completed At: 2025-10-01 15:59:33"
echo "   ğŸ“… Scheduled: 15:59"
echo "   ğŸ¯ FlowStep: Hiá»ƒn thá»‹ âœ“ vá»›i thá»i gian cháº¥m cÃ´ng"
echo "   ğŸ–¼ï¸ Modal: Hiá»ƒn thá»‹ áº£nh + 'âœ… Cháº¥m cÃ´ng Ä‘Ãºng giá»'"
echo ""

echo "ğŸ“‹ TASK 56 - 'fvbfhbv':"
echo "   âŒ Completed: false"
echo "   â° Completed At: null"
echo "   ğŸ“… Scheduled: 16:01"
echo "   ğŸ¯ FlowStep: Hiá»ƒn thá»‹ âš ï¸ vá»›i 'Cháº¥m cÃ´ng ngoÃ i giá»'"
echo "   ğŸ–¼ï¸ Modal: Hiá»ƒn thá»‹ áº£nh + 'âš ï¸ Cháº¥m cÃ´ng ngoÃ i giá»'"
echo ""

echo "ğŸ“‹ TASK 57 - 'nhÃ  Ä‘i chÆ¡i':"
echo "   âœ… Completed: true"
echo "   â° Completed At: 2025-10-01 16:01:26"
echo "   ğŸ“… Scheduled: 16:01"
echo "   ğŸ¯ FlowStep: Hiá»ƒn thá»‹ âœ“ vá»›i thá»i gian cháº¥m cÃ´ng"
echo "   ğŸ–¼ï¸ Modal: Hiá»ƒn thá»‹ áº£nh + 'âœ… Cháº¥m cÃ´ng Ä‘Ãºng giá»'"
echo ""

echo "=== HÆ¯á»šNG DáºªN KIá»‚M TRA ==="
echo "1. Má»Ÿ https://10.10.68.200:5173/admin-dashboard"
echo "2. ÄÄƒng nháº­p admin/admin123"
echo "3. Hard refresh (Ctrl+Shift+R)"
echo "4. Kiá»ƒm tra FlowStep hiá»ƒn thá»‹:"
echo "   - Task 55: âœ“ vá»›i thá»i gian 15:59"
echo "   - Task 56: âš ï¸ vá»›i 'Cháº¥m cÃ´ng ngoÃ i giá»'"
echo "   - Task 57: âœ“ vá»›i thá»i gian 16:01"
echo "5. Click vÃ o FlowStep Ä‘á»ƒ xem modal vá»›i áº£nh"
echo ""

echo "=== LOGIC HOáº T Äá»˜NG ==="
echo "âœ… Backend kiá»ƒm tra thá»i gian checkin vs scheduled_time"
echo "âœ… Chá»‰ set completed = 1 khi checkin trong Â±15 phÃºt"
echo "âœ… FlowStep hiá»ƒn thá»‹ completedAt tá»« stop.completed_at"
echo "âœ… Modal hiá»ƒn thá»‹ áº£nh vÃ  tráº¡ng thÃ¡i chÃ­nh xÃ¡c"
echo ""

echo "=== Náº¾U VáºªN KHÃ”NG THáº¤Y ==="
echo "1. Clear browser cache hoÃ n toÃ n"
echo "2. Thá»­ incognito mode"
echo "3. Kiá»ƒm tra console (F12) cÃ³ lá»—i khÃ´ng"
echo "4. Restart frontend: cd frontend && npm run dev"
