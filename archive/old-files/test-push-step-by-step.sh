#!/bin/bash

# 📱 TEST PUSH NOTIFICATION TỪNG BƯỚC
# Hướng dẫn test push notification chi tiết

echo "📱 TEST PUSH NOTIFICATION TỪNG BƯỚC"
echo "===================================="
echo "Hướng dẫn test push notification chi tiết..."
echo ""

FRONTEND_URL="https://10.10.68.200:5173"

echo "📱 HƯỚNG DẪN TEST PUSH NOTIFICATION:"
echo "====================================="
echo "1. Mở trình duyệt trên điện thoại"
echo "2. Truy cập: $FRONTEND_URL"
echo "3. Đăng nhập vào hệ thống"
echo "4. Làm theo các bước sau:"
echo ""
echo "🔍 BƯỚC 1: CÀI ĐẶT PWA (QUAN TRỌNG!)"
echo "====================================="
echo "• Tìm nút 'Cài đặt App' hoặc 'Install App'"
echo "• Bấm cài đặt PWA"
echo "• Hoặc menu → 'Add to Home Screen'"
echo "• Cài đặt app như app thật"
echo "• ⚠️ QUAN TRỌNG: Phải cài đặt PWA trước!"
echo ""
echo "🔍 BƯỚC 2: BẬT PUSH NOTIFICATION"
echo "================================="
echo "• Vào Settings → Push Notifications"
echo "• Bấm 'Enable Notifications'"
echo "• Cho phép notification permission khi browser hỏi"
echo "• Đợi thông báo 'Thông báo đã được bật!'"
echo "• ⚠️ QUAN TRỌNG: Phải cho phép notification permission!"
echo ""
echo "🔍 BƯỚC 3: TEST THÔNG BÁO THỦ CÔNG"
echo "==================================="
echo "• Bấm nút 'Test Notification'"
echo "• Kiểm tra xem có thông báo hiện không"
echo "• Nếu có thông báo → OK"
echo "• Nếu không có → Kiểm tra console logs"
echo ""
echo "🔍 BƯỚC 4: TEST TẠO NHIỆM VỤ"
echo "============================="
echo "• Admin tạo nhiệm vụ mới"
echo "• Giao cho employee"
echo "• Employee nhận thông báo"
echo "• Thông báo hiện trên điện thoại"
echo ""
echo "⚠️ NẾU KHÔNG CÓ THÔNG BÁO:"
echo "=========================="
echo "• Kiểm tra xem đã cài đặt PWA chưa"
echo "• Kiểm tra xem đã bật notification permission chưa"
echo "• Kiểm tra console logs để xem lỗi gì"
echo "• Thử refresh trang và làm lại"
echo "• Đảm bảo đang dùng HTTPS"
echo ""
echo "🔍 DEBUG CONSOLE LOGS:"
echo "======================"
echo "• Mở Developer Tools (F12)"
echo "• Vào tab Console"
echo "• Tìm các log sau:"
echo "  - 'Push notifications initialized successfully'"
echo "  - 'Subscription sent to server successfully'"
echo "  - 'Service Worker: Push notification received!'"
echo "  - 'REAL PUSH SENT'"
echo ""
echo "🔍 KIỂM TRA SERVICE WORKER:"
echo "==========================="
echo "• Vào Developer Tools → Application → Service Workers"
echo "• Kiểm tra xem service worker có active không"
echo "• Nếu không, thử refresh trang"
echo ""
echo "🔍 KIỂM TRA PUSH SUBSCRIPTION:"
echo "=============================="
echo "• Vào Developer Tools → Application → Storage"
echo "• Kiểm tra xem có push subscription không"
echo "• Nếu không có, thử bật lại notification"
echo ""
echo "⚠️ CÁC VẤN ĐỀ THƯỜNG GẶP:"
echo "========================"
echo "• Chưa cài đặt PWA → Cài đặt PWA trước"
echo "• Chưa bật notification permission → Bật permission"
echo "• Service worker chưa active → Refresh trang"
echo "• Chưa đăng ký push subscription → Bật notification"
echo "• Browser không hỗ trợ → Dùng Chrome/Firefox"
echo "• Đang dùng HTTP → Cần HTTPS cho push notification"
echo "• Chưa đăng nhập → Đăng nhập trước"
echo ""
echo "🔗 LINKS TRUY CẬP:"
echo "=================="
echo "• Local Network: $FRONTEND_URL"
echo "• Public (4G/WiFi khác): https://semiprivate-interlamellar-phillis.ngrok-free.dev"
echo ""
echo "🛑 Dừng hệ thống: ./stop-system.sh"
echo "🚀 Khởi động lại: ./start-system-ngrok.sh"
