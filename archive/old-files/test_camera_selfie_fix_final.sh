#!/bin/bash

echo "ğŸ”§ TEST CAMERA SELFIE FIX - FINAL VERSION"
echo "=========================================="

# Kiá»ƒm tra frontend Ä‘ang cháº¡y
echo "ğŸ“± Kiá»ƒm tra frontend..."
if curl -s -k https://10.10.68.200:5173 > /dev/null; then
    echo "âœ… Frontend Ä‘ang cháº¡y trÃªn https://10.10.68.200:5173"
else
    echo "âŒ Frontend khÃ´ng cháº¡y. Vui lÃ²ng khá»Ÿi Ä‘á»™ng frontend trÆ°á»›c."
    exit 1
fi

# Kiá»ƒm tra backend Ä‘ang cháº¡y
echo "ğŸ”§ Kiá»ƒm tra backend..."
if curl -s -k https://10.10.68.200:8000/health > /dev/null; then
    echo "âœ… Backend Ä‘ang cháº¡y trÃªn https://10.10.68.200:8000"
else
    echo "âŒ Backend khÃ´ng cháº¡y. Vui lÃ²ng khá»Ÿi Ä‘á»™ng backend trÆ°á»›c."
    exit 1
fi

echo ""
echo "ğŸ¯ HÆ¯á»šNG DáºªN TEST CAMERA SELFIE - FIXED VERSION:"
echo "================================================"
echo ""
echo "1. ğŸ“± Má»Ÿ trÃ¬nh duyá»‡t vÃ  truy cáº­p:"
echo "   https://10.10.68.200:5173"
echo ""
echo "2. ğŸ” ÄÄƒng nháº­p vá»›i tÃ i khoáº£n admin/manager/employee"
echo ""
echo "3. ğŸ“· Test trÃªn cÃ¡c trang:"
echo "   - QR Scanner: https://10.10.68.200:5173/qr-scan"
echo "   - Checkin: https://10.10.68.200:5173/checkin"
echo "   - Admin Dashboard: https://10.10.68.200:5173/admin-dashboard"
echo ""
echo "4. ğŸ¯ Test camera selfie:"
echo "   - QuÃ©t QR code báº¥t ká»³"
echo "   - Báº¥m 'Báº­t Camera' trong pháº§n 'Chá»¥p áº£nh xÃ¡c nháº­n'"
echo "   - Thá»­ chuyá»ƒn Ä‘á»•i giá»¯a camera sau vÃ  camera selfie"
echo "   - Test chá»¥p áº£nh vá»›i camera selfie"
echo "   - Táº¯t camera vÃ  báº­t láº¡i camera selfie"
echo ""
echo "5. ğŸ§ª Test file HTML Ä‘á»™c láº­p:"
echo "   Má»Ÿ file: test_camera_selfie.html trong trÃ¬nh duyá»‡t"
echo ""
echo "âœ… Cáº¢I TIáº¾N ÄÃƒ THá»°C HIá»†N:"
echo "========================"
echo ""
echo "1. ğŸŒ GlobalCameraManager - Quáº£n lÃ½ táº¥t cáº£ camera streams"
echo "   - Dá»«ng Táº¤T Cáº¢ streams trÆ°á»›c khi khá»Ÿi Ä‘á»™ng stream má»›i"
echo "   - TrÃ¡nh xung Ä‘á»™t giá»¯a cÃ¡c camera components"
echo "   - Äáº£m báº£o camera selfie khÃ´ng bá»‹ 'Ä‘ang Ä‘Æ°á»£c sá»­ dá»¥ng'"
echo ""
echo "2. ğŸ”§ Cáº­p nháº­t táº¥t cáº£ camera components:"
echo "   - SimpleMobileCamera (QR Scanner photo capture)"
echo "   - ScanCamera (QR Scanner)"
echo "   - StableCameraModal (Face auth)"
echo "   - CheckinPage camera functions"
echo "   - QRScannerPage camera functions"
echo ""
echo "3. ğŸ›¡ï¸ Cáº£i thiá»‡n xá»­ lÃ½ lá»—i:"
echo "   - ThÃ´ng bÃ¡o lá»—i cá»¥ thá»ƒ cho camera selfie"
echo "   - Fallback constraints khi camera selfie tháº¥t báº¡i"
echo "   - Timeout dÃ i hÆ¡n cho camera selfie (5s)"
echo ""
echo "4. â±ï¸ Tá»‘i Æ°u timing:"
echo "   - Delay 1s giá»¯a viá»‡c dá»«ng vÃ  khá»Ÿi Ä‘á»™ng camera"
echo "   - Äáº£m báº£o stream cÅ© hoÃ n toÃ n dá»«ng trÆ°á»›c khi khá»Ÿi Ä‘á»™ng má»›i"
echo ""
echo "5. ğŸ¯ useGlobalCamera hook:"
echo "   - Quáº£n lÃ½ camera toÃ n cá»¥c trong táº¥t cáº£ components"
echo "   - Tá»± Ä‘á»™ng cleanup khi component unmount"
echo ""
echo "ğŸ” CÃC Lá»–I ÄÃƒ Sá»¬A:"
echo "=================="
echo ""
echo "âŒ 'Camera selfie Ä‘ang Ä‘Æ°á»£c sá»­ dá»¥ng'"
echo "   âœ… FIXED: GlobalCameraManager dá»«ng táº¥t cáº£ streams trÆ°á»›c khi khá»Ÿi Ä‘á»™ng má»›i"
echo ""
echo "âŒ Camera selfie timeout"
echo "   âœ… FIXED: TÄƒng timeout tá»« 3s â†’ 5s, thÃªm fallback constraints"
echo ""
echo "âŒ Xung Ä‘á»™t giá»¯a QR scanner vÃ  photo camera"
echo "   âœ… FIXED: Má»—i camera cÃ³ ID riÃªng, quáº£n lÃ½ táº­p trung"
echo ""
echo "âŒ Camera khÃ´ng giáº£i phÃ³ng hoÃ n toÃ n"
echo "   âœ… FIXED: Äá»£i 1s Ä‘á»ƒ Ä‘áº£m báº£o stream dá»«ng hoÃ n toÃ n"
echo ""
echo "ğŸš€ Báº®T Äáº¦U TEST..."
echo "=================="
echo ""
echo "Má»Ÿ trÃ¬nh duyá»‡t vÃ  test theo hÆ°á»›ng dáº«n trÃªn!"
echo ""
echo "ğŸ“ Náº¿u váº«n gáº·p lá»—i, hÃ£y:"
echo "   1. Kiá»ƒm tra console log trong DevTools"
echo "   2. Thá»­ trÃªn thiáº¿t bá»‹ khÃ¡c"
echo "   3. Kiá»ƒm tra quyá»n camera trong trÃ¬nh duyá»‡t"
echo "   4. Restart trÃ¬nh duyá»‡t Ä‘á»ƒ clear cache"
echo ""
echo "ğŸ‰ Camera selfie bÃ¢y giá» sáº½ hoáº¡t Ä‘á»™ng á»•n Ä‘á»‹nh!"
echo ""
