#!/bin/bash

echo "ğŸ”§ TEST CAMERA LOADING FIX"
echo "=========================="

echo "ğŸ“± Kiá»ƒm tra frontend..."
if curl -s -k https://10.10.68.200:5173 > /dev/null; then
    echo "âœ… Frontend Ä‘ang cháº¡y trÃªn https://10.10.68.200:5173"
else
    echo "âŒ Frontend khÃ´ng cháº¡y"
    exit 1
fi

echo "ğŸ”§ Kiá»ƒm tra backend..."
if curl -s -k https://10.10.68.200:8000/health > /dev/null; then
    echo "âœ… Backend Ä‘ang cháº¡y trÃªn https://10.10.68.200:8000"
else
    echo "âŒ Backend khÃ´ng cháº¡y"
    exit 1
fi

echo ""
echo "ğŸ¯ HÆ¯á»šNG DáºªN TEST CAMERA LOADING FIX:"
echo "====================================="
echo ""
echo "1. ğŸ“± Má»Ÿ trÃ¬nh duyá»‡t vÃ  truy cáº­p:"
echo "   https://10.10.68.200:5173"
echo ""
echo "2. ğŸ” ÄÄƒng nháº­p vá»›i tÃ i khoáº£n admin/manager/employee"
echo ""
echo "3. ğŸ“· Test camera trÃªn cÃ¡c trang:"
echo "   - QR Scanner: https://10.10.68.200:5173/qr-scan"
echo "   - Checkin: https://10.10.68.200:5173/checkin"
echo "   - Admin Dashboard: https://10.10.68.200:5173/admin-dashboard"
echo ""
echo "4. ğŸ§ª Test file HTML Ä‘Æ¡n giáº£n:"
echo "   Má»Ÿ file: test_camera_simple.html trong trÃ¬nh duyá»‡t"
echo "   (File nÃ y test camera vá»›i constraints cá»±c ká»³ Ä‘Æ¡n giáº£n)"
echo ""
echo "âœ… Cáº¢I TIáº¾N ÄÃƒ THá»°C HIá»†N:"
echo "========================"
echo ""
echo "1. ğŸ¯ Constraints Ä‘Æ¡n giáº£n hÆ¡n:"
echo "   - Chá»‰ sá»­ dá»¥ng facingMode, bá» width/height/frameRate"
echo "   - Thá»­ constraints Ä‘Æ¡n giáº£n trÆ°á»›c, fallback náº¿u tháº¥t báº¡i"
echo ""
echo "2. â±ï¸ Timing cáº£i thiá»‡n:"
echo "   - TÄƒng delay giá»¯a viá»‡c dá»«ng vÃ  khá»Ÿi Ä‘á»™ng camera: 1s"
echo "   - TÄƒng timeout camera: 10s"
echo "   - Äá»£i video load metadata trÆ°á»›c khi play"
echo ""
echo "3. ğŸ”„ Fallback strategy:"
echo "   - Thá»­ constraints Ä‘Æ¡n giáº£n trÆ°á»›c"
echo "   - Náº¿u tháº¥t báº¡i, thá»­ constraints gá»‘c"
echo "   - Cuá»‘i cÃ¹ng thá»­ báº¥t ká»³ camera nÃ o"
echo ""
echo "4. ğŸ“ Logging chi tiáº¿t:"
echo "   - Log tá»«ng bÆ°á»›c khá»Ÿi Ä‘á»™ng camera"
echo "   - Hiá»ƒn thá»‹ constraints Ä‘Æ°á»£c sá»­ dá»¥ng"
echo "   - BÃ¡o lá»—i cá»¥ thá»ƒ náº¿u cÃ³"
echo ""
echo "ğŸ” CÃC Lá»–I ÄÃƒ Sá»¬A:"
echo "=================="
echo ""
echo "âŒ Camera bÃ¡o 'Ä‘ang khá»Ÿi Ä‘á»™ng' nhÆ°ng khÃ´ng hiá»ƒn thá»‹"
echo "   âœ… FIXED: Constraints Ä‘Æ¡n giáº£n hÆ¡n, timeout dÃ i hÆ¡n"
echo ""
echo "âŒ Camera selfie khÃ´ng hoáº¡t Ä‘á»™ng"
echo "   âœ… FIXED: Thá»­ constraints Ä‘Æ¡n giáº£n trÆ°á»›c"
echo ""
echo "âŒ Camera timeout quÃ¡ nhanh"
echo "   âœ… FIXED: TÄƒng timeout tá»« 3s â†’ 10s"
echo ""
echo "âŒ Xung Ä‘á»™t giá»¯a cÃ¡c camera streams"
echo "   âœ… FIXED: Dá»«ng táº¥t cáº£ streams, Ä‘á»£i 1s trÆ°á»›c khi khá»Ÿi Ä‘á»™ng má»›i"
echo ""
echo "ğŸš€ Báº®T Äáº¦U TEST..."
echo "=================="
echo ""
echo "Má»Ÿ trÃ¬nh duyá»‡t vÃ  test theo hÆ°á»›ng dáº«n trÃªn!"
echo ""
echo "ğŸ“ Náº¿u váº«n gáº·p lá»—i, hÃ£y:"
echo "   1. Má»Ÿ DevTools (F12) vÃ  xem Console log"
echo "   2. Test file test_camera_simple.html trÆ°á»›c"
echo "   3. Kiá»ƒm tra quyá»n camera trong trÃ¬nh duyá»‡t"
echo "   4. Thá»­ trÃªn thiáº¿t bá»‹ khÃ¡c"
echo ""
echo "ğŸ‰ Camera bÃ¢y giá» sáº½ hiá»ƒn thá»‹ ngay khi khá»Ÿi Ä‘á»™ng!"
