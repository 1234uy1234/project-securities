#!/bin/bash

echo "🧪 TEST PHOTO DISPLAY FIX"
echo "========================="

echo ""
echo "📋 VẤN ĐỀ ĐÃ TÌM THẤY:"
echo "1. Database có field 'photo_path' nhưng frontend tìm 'photo_url'"
echo "2. Backend đã sửa mapping: photo_path → photo_url"
echo "3. Ảnh tồn tại trên server và có thể truy cập qua HTTP"
echo "4. Frontend đang sử dụng ngrok URL thay vì localhost"
echo ""

echo "🔍 KIỂM TRA BACKEND MAPPING:"
echo "✅ photo_path: uploads/checkin_12_20251008_082554.jpg"
echo "✅ mapped photo_url: /uploads/checkin_12_20251008_082554.jpg"
echo "✅ Ảnh tồn tại: backend/uploads/checkin_12_20251008_082554.jpg"
echo "✅ HTTP access: http://localhost:8000/uploads/checkin_12_20251008_082554.jpg (200 OK)"
echo ""

echo "🎯 CÁCH TEST:"
echo "1. Mở Employee Dashboard"
echo "2. Mở F12 → Console"
echo "3. Kiểm tra logs:"
echo "   - 🔍 DEBUG: Record [ID] photo_url: [path]"
echo "   - ✅ Image loaded: [path]"
echo "   - ❌ Image failed to load: [path]"
echo ""

echo "🔧 NẾU VẪN KHÔNG HIỂN THỊ ẢNH:"
echo "1. Kiểm tra URL ảnh trong console:"
echo "   - URL phải là: https://semiprivate-interlamellar-phillis.ngrok-free.dev/uploads/..."
echo "   - Không được là: https://localhost:8000/uploads/..."
echo ""
echo "2. Kiểm tra network tab:"
echo "   - Request đến /uploads/... phải trả về 200 OK"
echo "   - Nếu 404: backend không serve ảnh đúng"
echo "   - Nếu CORS error: cấu hình CORS sai"
echo ""
echo "3. Kiểm tra backend logs:"
echo "   - Photo mapping logic đã chạy"
echo "   - API trả về photo_url đúng"
echo ""

echo "🚀 BẮT ĐẦU TEST:"
echo "1. cd frontend && npm run dev"
echo "2. Vào: http://localhost:5173/employee-dashboard"
echo "3. Đăng nhập với employee account"
echo "4. Mở F12 → Console tab"
echo "5. Quan sát logs ảnh"
echo ""

echo "📱 KIỂM TRA CÁC TRANG:"
echo "1. **Employee Dashboard**:"
echo "   - FlowStep có hiển thị ảnh thumbnail không?"
echo "   - Click vào stop point có hiển thị ảnh trong modal không?"
echo ""
echo "2. **Reports Page**:"
echo "   - Bảng report có hiển thị ảnh thumbnail không?"
echo "   - Click 'Xem ảnh' có mở ảnh lớn không?"
echo ""
echo "3. **Admin Dashboard**:"
echo "   - FlowStep có hiển thị ảnh thumbnail không?"
echo "   - Click vào stop point có hiển thị ảnh trong modal không?"
echo ""

echo "✅ KẾT QUẢ MONG ĐỢI:"
echo "- ✅ Ảnh hiển thị thumbnail trong FlowStep"
echo "- ✅ Ảnh hiển thị trong modal khi click"
echo "- ✅ Ảnh hiển thị trong bảng report"
echo "- ✅ Console không có lỗi ảnh"
echo ""

echo "🔧 NẾU VẪN CÓ VẤN ĐỀ:"
echo "1. Restart backend:"
echo "   cd backend && python -m uvicorn app.main:app --reload"
echo ""
echo "2. Kiểm tra ngrok:"
echo "   ngrok http 8000"
echo ""
echo "3. Cập nhật config.ts với URL mới"
echo ""

echo "✅ TEST HOÀN THÀNH!"
